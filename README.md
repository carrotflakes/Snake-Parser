# Snake Parser

Snake ParserはJavaScript製のパーサジェネレータです。
構造を持ったテキストを入力としてJavaScript上でデータを得たいときに使います。
テキストからデータを取り出すためには、どのように取り出すかを記述した*文法*が必要です。
Snake Parserは文法を入力として、パースするためのJavaScriptコードを出力します。


実行はこちら。  
https://carrotflakes.github.io/Snake-Parser/

## 特徴
- PEGっぽい文法
- 左再帰に対応

## 文法記述法
### 基本
文法は以下のように記述します。

```
// モディファイアの定義
{
  modifier1: function($) {
	  return ...;
	},
	...
}

// ルールの定義
start = rule1

rule1 = ...
```

最初にモディファイアを定義します。関数を格納したオブジェクトのように書きます。モディファイアが不要であれば `{}` ごと省略することができます。
次にルールを `ルール名 = パージング表現` の形で定義します。ルール名は `[a-zA-Z_][a-zA-Z0-9_]*` の正規表現を満たすものが使えます。`start` は最初に呼び出されるルールです。
文法記述の中にはJavaScriptのように、`//`, `/* */`でコメントを書き込むこともできます。

### パージング表現
[TODO]

#### マッチング
    'A'
    "A"
文字列 `A` にマッチします。

    [A]
文字の集合を表します。 `[]` で囲まれた文字のいずれかにマッチします。
例えば、 `[abcd]` は `a` `b` `c` `d` のいずれかの文字にマッチします。
また `[abcdf]` は `[a-df]` のように書くことが可能です。

    [^A]
`[A]` にマッチしない文字にマッチします。

    .
任意の1文字にマッチします。

#### 量化
    ?A
パージング表現 `A` でのパースを試行します。パースに成功しても失敗しても `?A` は成功です。

    *A
パージング表現 `A` を失敗するまで繰り返します。

    +A
パージング表現 `A` を失敗するまで繰り返します。１回以上成功しないと `+A` は失敗になります。

    n*A
`A` を `n` 回繰り返したものと同値です。

    n,m*A
パージング表現 `A` を失敗するまで繰り返します。成功回数が `n` から `m`
ならばこのパースは成功です。

#### 制御
    A
ルール `A` でパースします。

    &A
パージング表現 `A` でパースします。パースに成功してもポインタを進めません。

    !
パージング表現 `A` でパースを試み、成功すればこのパースは失敗です。失敗すればこのパースは成功になります。

    A|B
パージング表現 `A` でパースします。`A` が失敗ならば、 パージング表現 `B` でパースをします。

    A B
パージング表現 `A` でパースします。`A` 成功すれば、次にパージング表現 `B` でパースをします。

    (...)
括弧の中をひとまとまりに扱います

#### 返り値
    `A
`A` でマッチした文字列を返り値とします。

    {...}
括弧内の `A:B` や `A:=B` を要素とするオブジェクトを返り値にします。

    A:B
`{...}` によってオブジェクトが作られるとき、パージング表現 `B` の返り値を、文字列 `A` をキーとしてオブジェクトに格納します。

    A:=B
`{...}` によってオブジェクトが作られるとき、文字列 `B` を、文字列 `A` をキーとしてオブジェクトに格納します。

    @A
パージング表現 `A` の中では複数の返り値 を返すことを許可します。その複数の返り値を1つの配列として返り値にします。

    A>M
`M` はモディファイア名です。パージング表現 `A` の返り値をモディファイア `M` で加工して返り値とします。

    A>{M}
モディファイアの別の表記法です。モディファイアの定義で定義していない関数が使用できます。`M` には引数が `$` の関数のボディ部分を与えて下さい。
e.g. `A>{return parseInt($);}`

    \123
    \"Hello"
    \true
    \null
numeric や string 、 boolean 、 null などの値をそのまま返り値とします。

#### その他
    $pos
    $input
    $row
    $column
未実装[TODO]


## 文法記述例
次の文法は `+` と `*` と整数を使った数式を計算する関数を生成します。
`1+2*3` を入力すると `7` が出力されます。

```
// モディファイア定義
{
  additive: function($) {
    return $.left + $.right;
  },
  multiplicative: function($) {
    return $.left * $.right;
  },
  integer: function($) {
    return +$;
  }
}

// ルール定義
start =
  additive

additive =
  {left:multiplicative "+" right:additive} > additive
  | multiplicative

multiplicative =
  {left:primary "*" right:multiplicative} > multiplicative
  | primary

primary =
  integer
  | "(" additive ")"

integer =
  `+[0-9]>integer
```
